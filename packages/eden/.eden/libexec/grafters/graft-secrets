#!/bin/bash
# graft-secrets - Validate secrets from trunk and branches
# Part of Eden's pluggable grafter system
set -e

# Find Eden root
if [[ -z "$EDEN_ROOT" ]]; then
    SCRIPT_PATH="$(readlink -f "${BASH_SOURCE[0]}" 2>/dev/null || echo "${BASH_SOURCE[0]}")"
    EDEN_ROOT="$(cd "$(dirname "$SCRIPT_PATH")/../../../../.." && pwd)"
fi

# Check if eden-secrets exists
if [ ! -f "$EDEN_ROOT/bin/eden-secrets" ]; then
    echo "  → eden-secrets not found (skipping)"
    exit 0
fi

# Run validation (will check trunk + all branches)
if "$EDEN_ROOT/bin/eden-secrets" validate --quiet >/dev/null 2>&1; then
    echo "  ✓ All required secrets configured"
else
    echo "  ⚠ Some secrets are not configured"
    echo "    Run 'eden-secrets validate' for details"
fi

exit 0

